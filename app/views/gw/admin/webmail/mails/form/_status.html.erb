<script type="text/javascript">
//<![CDATA[
function submitMailForm(button) {
  $('#item_form')
    .append( $('<input />').attr({name: button.name, value: button.value, type: 'hidden'}) )
    .submit();
}
function checkServerStatus(button) {
  $.post('<%=raw status_gw_webmail_servers_path(format: :json) %>', {
    authenticity_token: $('input[name="authenticity_token"]').val()
  })
  .done(function(data) {
    switch (data.status) {
    case 'OK':
      submitMailForm(button)
      break;
    case 'NG TokenError':
    case '500 This is a secure page.':
      alert('ログイン状態がリセットされました。画面を閉じて再度ログインしてから送信して下さい。');
      break;
    default:
      alert('サーバーの応答がありません。しばらく時間をおいて送信して下さい。');
      break;
    }
  })
  .fail(function() {
    alert('エラーが発生しました。しばらく時間をおいて送信して下さい。');
  });
}
//]]>
</script>
